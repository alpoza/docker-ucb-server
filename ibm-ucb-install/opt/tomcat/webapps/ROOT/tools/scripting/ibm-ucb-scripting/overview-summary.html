<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0) on Tue Feb 23 14:43:38 EST 2016 -->
<TITLE>
Overview (IBM UrbanCode Build Scripting)
</TITLE>

<META NAME="date" CONTENT="2016-02-23">

<LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="Overview (IBM UrbanCode Build Scripting)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Overview</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Package</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="overview-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="serialized-form.html"><FONT CLASS="NavBarFont1"><B>Serialized</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="index.html?overview-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="overview-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<CENTER>
<H1>
<h1>IBM UrbanCode Build Scripting</h1>
</H1>
</CENTER>
IBM UrbanCode Build Scripting Guide
<P>
<B>See:</B>
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF="#overview_description"><B>Description</B></A>
<P>

<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Packages</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/urbancode/ubuild/scripting/package-summary.html">com.urbancode.ubuild.scripting</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/urbancode/ubuild/scripting/jobs/package-summary.html">com.urbancode.ubuild.scripting.jobs</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/urbancode/ubuild/scripting/notifications/package-summary.html">com.urbancode.ubuild.scripting.notifications</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/urbancode/ubuild/scripting/notifications/recipients/package-summary.html">com.urbancode.ubuild.scripting.notifications.recipients</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/urbancode/ubuild/scripting/reporting/package-summary.html">com.urbancode.ubuild.scripting.reporting</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/urbancode/ubuild/scripting/steps/package-summary.html">com.urbancode.ubuild.scripting.steps</A></B></TD>
<TD>&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD WIDTH="20%"><B><A HREF="com/urbancode/ubuild/scripting/wrappers/package-summary.html">com.urbancode.ubuild.scripting.wrappers</A></B></TD>
<TD>&nbsp;</TD>
</TR>
</TABLE>

<P>
&nbsp;<A NAME="overview_description"><!-- --></A>
<P>
<h1>IBM UrbanCode Build Scripting Guide</h1>

    <br/>
    <h2>Scripting Usage</h2>
    <p>Scripting is used in two ways in IBM UrbanCode Build. The first is that a number of configuration elements are actually scripts
    themselves. These are usually used when a decision is needed, such as checking if a job needs to run or checking if
    a step completed successfully. These scripts are written in Javascript and the script usually needs to return a
    object or value. The other type of scripting is scriptlets which are short scripts embedded in configuration.
    These are often used to dynamically reference properties or other configuration elements. A good example of
    scriptlet use would be in the working directory value. The working directory defines where a build is going to
    occur. As you can imagine, you would want this configuration to be somewhat dynamic. All builds should not happen
    in the same directory, so you may want to use the project name in the working directory. You do this with
    scriptlets.</p>

    <br/>
    <h2>Scriptlets</h2>
    <p>Almost everywhere you can input configuration into IBM UrbanCode Build, you can use scriptlets in the value. When the
    configuration value is used, the scriptlet is evaluated and the scriptlet is replaced in the configuration value
    with what it evaluates to. Scriptlet syntax is as follows:</p>
    <code>${prefix:scriptlet_body}</code>.
    <p>The options for prefix are the following:
    <ul>
    <li><code>${p:property_name}</code> or <code>${property:property_name}</code>
    - <br/>If defined as a non-agent property, replace with the value. If not defined, leave the given expression.</li>
    <li><code>${p?:property_name}</code> or <code>${property?:property_name}</code>
    - <br/>If defined as a non-agent property, replace with the value. If not defined, replace the expression source with a empty string.</li>
    <li><code>${property_name}</code> or <code>${a:property_name}</code> or <code>${agent:property_name}</code>
    - <br/>If defined as a agent property, replace with the value. If not defined, leave the given expression.</li>
    <li><code>${?:property_name}</code> or <code>${a?:property_name}</code> or <code>${agent?:property_name}</code>
    - <br/>If defined as a agent property, replace with the value. If not defined, replace the expression source with a empty string.</li>
    <li><code>${gvy:script_body}</code>
    - Execute the script_body as Groovy and replace with the return value.</li>
    <li><code>${bsh:script_body}</code>
    - Execute the script_body as Beanshell and replace with the return value.</li>
    </ul>
    <br/><br/>
    <h3>Property Scriptlets</h3>
    Properties are looked up starting with the smallest scope available and then increasing the scope until the property
    is found. You can also access a property directly using the scope. The scope order follows with how to access it:
    <ul>
      <li>Step - <code>${p:step/property_name}</code></li>
      <li>Job - <code>${p:job/property_name}</code></li>
      <li>Build Request - <code>${p:request/property_name}</code></li>
      <li>Source Config (only available in source steps) - <code>${p:sourceConfig/property_name}</code></li>
      <li>Source Config (always available) - <code>${p:process/sourceConfigs/properties[@name='property_name']}</code></li>
      <li>Process - <code>${p:process/property_name}</code></li>
      <li>Build Life - <code>${p:buildlife/property_name}</code></li>
      <li>Build Life Build Process - <code>${p:originatingProcess/property_name}</code></li>
      <li>Build Life Build Request - <code>${p:originatingRequest/property_name}</code></li>
      <li>Project - <code>${p:project/property_name}</code></li>
      <li>Server</li>
    </ul>
    <br/>
    <h3>Agent Property Scriptlets</h3>
    <p>Agent properties are accessed separately. You can access properties you define on the agents directly and you
    can also access the agent's environment variables:</p>
    <p>To access an agent property: <code>${property_name}</code></p>
    <p>To access an agent environment variable, use a scope of "env": <code>${env/PATH}</code></p>
    <br/>
    <h3>Scripting Language Scriptlets</h3>
    <p>Short scripts are usually comprised of a single call to one of the script helpers (see Script Helpers). The classic example
    of this is to lookup the most recent stamp (version) applied to a particular build life and pass that to the build
    script as the version. The build script can then use that to name the binaries generated with the version number or
    inject that value into the executable. To do that for an Ant build script, enter the following script fragment into the
    build script properties: <code>-Dversion=${p:buildlife/latestStamp}</code>.
    The format for these scripts also requires a leading dollar sign with the contents enclosed in curly braces. The result of the script will be substituted back in. So if building version 1.0.5 of a project, the parameter
    <code>-Dversion=1.0.5</code> will be passed to the build script.</p>

    <br/>
    <h2>Configuration Scripts</h2>
    <p>Javascript scripts are used in areas of configuration where a decision or value is needed that could be based on
    many factors. In these cases, there is no requirement to wrap the script in any extra markup. If there is no language
    selector on the page or it is otherwise noted, Javascript is the scripting language. An example of script usage like
    this is in notification configuration. Notifications need to determine who to notify. When determining who to notify
    about a build failure, you may want to look up some information such as who started the build or who made source
    changes since the previous successful build. Scripts allow you to access the information to make decisions like
    these. These scripts will also have objects already bound to the script that you can access a already defined
    variables. See the documentation below for the objects that are automatically available to the type of script you
    are working with.</p>

    <br/>
    <h2>Using the Script Library</h2>
    <p>Use the script library to create, organize, and provide security around often-used scripts. To use the Script
    Library, see Create a Script in the Script Library.</p>

    <br/>
    <h2>Create a Script in the Script Library</h2>
    <p>Script creation is performed on the System page, so make sure you have administrative permissions before continuing.
    IBM UrbanCode Build ships with a set of default scripts that control how IBM UrbanCode Build performs basic tasks; however, you
    will most likely want to create custom scripts to further define how IBM UrbanCode Build behaves. To create a new script, go to
    the System page and select the appropriate script type from the Script Library or Notification menu. The process for
    creating scripts is the same for each script type; however, the actual scripts will vary.
    </p>
    To create a new Script:
    <ol>
      <li>Go to the System page and select the appropriate script type. Currently, you can
        create a new script for the following:
        <ul>
          <li>Event Selector Scripts</li>
          <li>Job Pre-Condition Scripts</li>
          <li>Post-Processing Scripts</li>
          <li>Step Pre-Condition Scripts</li>
          <li>Working Directory Scripts</li>
        </ul>
      </li>
      <li>On the Script List page, click the Create New button.</li>
      <li>Create Script:
        <ul>
          <li>Name the script.</li>
          <li>Description. Give a description of the new script.</li>
          <li>Script. Input the body of the script. For instructions on writing the script, see either Event Scripts,
            Job Pre-Condition Scripts, Scripted Stamping, Step Pre-Condition Scripts, or Working Directory Scripts.</li>
        </ul>
      </li>
      <li>Click Save.</li>
    </ol>

    <br/>
    <h2>Job Pre-Condition Scripts</h2>
    <p>Job Pre-Condition script are used to determine if a Job should run. To do so, they must be written in JavaScript and return
    either true or false. Job Pre-Condition scripts may be created and/or edited at System &gt; Job Pre-Condition. IBM UrbanCode Build
    is packaged with a default library of Job Pre-Condition Scripts that will meet most needs; however, it is possible
    to add new scripts (see Creating Job Pre-Condition Scripts) based on other events. Currently, IBM UrbanCode Build ships with
    the following Job Pre-Condition Scripts:
    <ul>
      <li>All Ancestor Jobs Success. IBM UrbanCode Build will run this job only if all previous jobs succeed.</li>
      <li>All Ancestor Jobs Success or Not Needed. IBM UrbanCode Build will run this job if all previous jobs succeeded or were not needed.</li>
      <li>All Completed Jobs Success. IBM UrbanCode Build will run this job if all completed jobs prior to this one have been successful.</li>
      <li>Always. IBM UrbanCode Build always executes this job, regardless of previous job success or failure.</li>
      <li>Fail Iterated Job Fast. IBM UrbanCode Build will run this job if all ancestor jobs were successful or not needed or there
        are no ancestor jobs and all completed iterated jobs were successful.</li>
      <li>Never. IBM UrbanCode Build will never run this job.</li>
      <li>Parent Job Success. IBM UrbanCode Build will run this job only if the parent job succeeds.</li>
      <li>Parent Job Success or Not Needed. IBM UrbanCode Build will run this job if the parent job succeeds or was not needed or there were no parent jobs.</li>
      <li>Run on Any Failure. IBM UrbanCode Build will run this job if any completed job in the process is a failure.</li>
    </ul>

    Note that when editing existing Job Pre-Condition Scripts, any changes made will be applied to every job using that
    script. It is usually best to copy the script of an existing Job Pre-Condition Script and paste it into a newly created
    script to avoid any deleterious effects on other projects.

    <br/>
    <h3>Job Pre-Condition Script Prerequisites</h3>
    <ul>
      <li>You must have permissions to the System page.</li>
      <li>Understanding of IBM UrbanCode Build scripting. See Scripting Basics.</li>
    </ul>

    <h3>Creating Job Pre-Condition Scripts</h3>
    To create and/or edit a Job Pre-Condition Script:
    <ol>
      <li>Go to System &gt; Job Pre-Condition under the Script Library menu.</li>
      <li>Click Create New on the Job Pre-Condition Scripts page to create a new script.
        If editing an existing Job Pre-Condition Script, select it from the list of scripts. When editing scripts,
        all changes will effect every job that uses the script.</li>
      <li>Create/edit script:
        <ul>
          <li>Name. Give a name of this script. Once created, the name will appear in the Job Pre-Condition field during
            configuration.</li>
          <li>Description. Give a description of this script. The description will appear on the Job Pre-Condition main page.</li>
          <li>Script. Give the script, returning either true or false, that will determine if the job should run or not. See Custom
            Job Pre-Condition Scripts.</li>
          <li>Click Save.</li>
        </ul>
      </li>
    </ol>
    Once created, the Job Pre-Condition Script will appear on the Job Pre-Condition Scripts page. The Used In column
    details what projects and/or library jobs use the script.

    <h3>Using Job Pre-Condition Scripts</h3>
    <p>Once a Job Precondition Script has been created, select it from the drop-down menu when adding a job to a workflow.

    <br/>
    <h3>Custom Job Pre-Condition Scripts</h3>
    It is also possible to create custom Job Pre-Condition Scripts based on other events. When writing job pre-condition
    scripts, the scripts have access to a 'buildLifeStatus' object, a 'jobStatus' object, a 'stamps' object, and a 'properties' object.
    For example, the Job Pre-Condition Script below will only run the job if a particular status ("candidate") has been
    applied to the Build Life. If the Build Life does not have that status, the job will not run:
    <pre>    buildLifeStatus.has("candidate")</pre>

    To check if all ancestor job had a status of success:
    <pre>    jobStatus.allAncestorsIn(SUCCESS)</pre>

    To check if the build life for the job has a stamp containing 'DEV':
    <pre>    stamps.latestStampContains('DEV')</pre>

    To check if the build life or job has a property 'os':
    <pre>    properties.has('os')</pre>
    <br/>
    <h2>Step Pre-Condition Scripts</h2>
    <p>Step Pre-Condition script are used to determine if a step should run. To do so, they must be written in JavaScript
    and return either true or false. Step Pre-Condition scripts may be created and/or edited at System &gt; Step
    Pre-Condition (see Creating Step Pre-Condition Scripts).
    <br/><br/>
    IBM UrbanCode Build is packaged with a default library of Step Pre-Condition Scripts that will meet most needs; however, it is
    also possible to add new scripts (see Custom Step Pre-Condition Scripts) based on other events. Currently, IBM UrbanCode Build
    ships with the following Step Pre-Condition Scripts:
    <ul>
      <li>All Prior Success. IBM UrbanCode Build will run this step only if all previous steps in the job succeed.</li>
      <li>Always. IBM UrbanCode Build executes this step every time the job is run, regardless of previous step success or failure.</li>
      <li>Any Prior Failure. If any previous job step fails, IBM UrbanCode Build will run this step.</li>
      <li>Never. IBM UrbanCode Build will never run this step.</li>
      <li>Prior Failure. If the immediately preceding step failed, IBM UrbanCode Build will run this step.</li>
      <li>Prior Success. IBM UrbanCode Build will run this step only if the immediately preceding step succeeded.</li>
    </ul>
    Note that when editing existing Step Pre-Condition Scripts, any changes made will be applied to every step using
    that script. It is usually best to copy an existing Step Pre-Condition Script and paste it into a newly created script to
    avoid any deleterious effects on other projects.
    <br/><br/>
    See also Using the Script Library.

    <h3>Step Pre-Condition Script Prerequisites</h3>
    <ul>
      <li>You must have permissions to the System page.</li>
      <li>Understanding of IBM UrbanCode Build scripting. See Scripting Basics.</li>
    </ul>

    <h3>Creating Step Pre-Condition Scripts</h3>
    To create and/or edit a Step Pre-Condition Script:
    <ol>
      <li>Go to System &gt; Step Pre-Condition under the Script Library menu.</li>
      <li>Click Create New on the Step Pre-Condition Scripts page to create a new script.
        If editing an existing Step Pre-Condition Script, select it from the list of scripts.
        When editing scripts, all changes will effect every project and/or job that use the script.</li>
      <li>Create/edit script:
        <ul>
          <li>Name. Give a name of this script. Once created, the name will appear in the Step Pre-Condition field during
            step configuration.</li>
          <li>Description. Give a description of this script. The description will appear on the Step Pre-Condition main
            page, and be displayed during step configuration when a user chooses to edit this script. For example, the
            description could include a warning not to edit the script, etc.</li>
          <li>Script. Give the script, that returns a Criteria object, that will determine if the step should run or not.
            See Custom Step Pre-Condition Scripts.</li>
        </ul>
      </li>
      <li>Click Save.</li>
      <li>Once created, the Step Pre-Condition Script will appear on the Step Pre-Condition Scripts page. The Used In
        column details what projects and/or library jobs use the script.</li>
    </ol>

    <h3>Example Step Pre-Condition Scrips</h3>
    To look for a status (or multiple statuses) to be on all prior steps:
    <pre>    stepStatus.allPriorIn(SUCCESS);</pre>
    <pre>    stepStatus.allPriorIn(SUCCESS, SUCCESS_WARN);</pre>

    To look for a status (or multiple statuses) to be on the prior step:
    <pre>    stepStatus.priorIn(SUCCESS);</pre>
    <pre>    stepStatus.priorIn(SUCCESS, SUCCESS_WARN);</pre>

    To always run a step:
    <pre>    true</pre>

    <br/>
    <h2>Working Directory Scripts</h2>
    <p>Working directory scripts are created on the System page and are used by a project's source configuration to determine
    the directory the checked-out source will be placed in. Also, the set working directory step for a secondary process job
    uses working directory scripts. Working Directory scripts can be written using Groovy and BeanShell and may also make
    use of property resolution.
    <br/><br/>
    A working directory script is designed as a short script, so hard coded values may be entered for things like using a
    file system repository, or always running an installer from a particular directory. Nothing special is passed into
    working directory scripts, and the value generated is computed at process execution time on the agent in order to
    generate the working directory.
    <br/><br/>
    IBM UrbanCode Build is packaged with a Default Working Directory Script that is available for every project that uses a
    working directory script (go to System &gt; Work Dir under the Script Library menu to view). It may be used as an
    example when creating new scripts.
    <br/><br/>
    When editing a working directory script, remember that any changes you make to a script will effect every project
    using that script. The easiest way to modify a script is to copy it and then create a new one with the changes.
    <br/><br/>
    See also Using the Script Library.

    <h3>Create and Use Working Directory Scripts</h3>
    If a Set Working Directory job step is used, it will always override the Working Directory Script set on the process.
    For example, adding a job step that sets the Working Directory to C:\Project_A\Subproject_01 will override the
    Working Directory (of C:\Project_A\) selected during Source Configuration. The job will always be run in the
    C:\Project_A\Subproject_01 directory. Ensure that the Working Directory is not set to something like C: or C:\
    because the entire contents of the C drive will be permanently removed. Also note that if the Working Directory of
    C:\Project_A\ is set to clean up the workspace, the contents of C:\Project_A\Subproject_01 will be removed as well.
    This may have an adverse effect on jobs that use the C:\Project_A\Subproject_01 directory.
    <br/><br/>
    Before you start, make sure you have Administrative permissions to the System page.
    <ol>
      <li>Go to System &gt; Work Dir under the Script Library menu.</li>
      <li>Click the Create New button.</li>
      <li>Create Script:
        <ul>
          <li>Name the script.</li>
          <li>Description. Give an optional description.</li>
          <li>Script. Input the path of the working directory in the text field. This may include any ${property:} variables
            and ${gvy:...} or ${bsh:...} scriptlets. It is advisable to create a separate Working Directory Script for each project.</li>
        </ul>
      </li>
      <li>Click Save.</li>
    </ol>

    <h3>Example Working Directory Scripts</h3>
    To use a 'scratch' directory for a Linux user:
    <pre>    /home/userName/scratch</pre>

    The Unique Job Directory script that ships with IBM UrbanCode Build makes use of property resolution
    <pre>    ${env/AGENT_HOME}/var/work/job/${p:job/id}</pre>
    <br/>

    <h2>Notification Template Scripts</h2>
    <p>Because the notification template for a job is necessarily different from that for a process, different template
    scripts are used. IBM UrbanCode Build supports two basic Notification Template types: one for e-mails and one for instant
    messaging.
    <br/><br/>
    The same parameters are passed to both template types. When and how each type will be used is project and team
    specific. Depending on your needs, you will most likely have a combination of e-mail and IM templates notifying
    team members on a number of events. Any other IBM UrbanCode Build actions that require either an e-mail or IM to be sent may
    fail unless the Notification Template is properly configured.

    <h3>Example E-mail Notification Template Script</h3>
    The script for the Simple Workflow Email Template that ships with IBM UrbanCode Build is pretty typical, and can be used as
    a prototype for creating other templates. It looks up the server settings so that the template can provide a link back to
    the project in question. It also looks up any change logs associated with the process so the changes in the build can
    be sent to interested parties.
    <ol>
      <li>To view, go to System &gt; Notification Templates under the Notification menu.</li>
      <li>On the Notification Template List page, select the edit icon of the Simple Workflow Email Template.</li>
    </ol>

    <h3>E-mail Notification Template Text</h3>
    The Template Text is where the Velocity Template is created. In addition to the standard Velocity text (see the
    Velocity Documentation [http://velocity.apache.org/]), the Template Text is capable of using some information from within
    IBM UrbanCode Build such as projects and processes.
    <br/>
    The ## BEGIN SECTION Subject and ## END SECTION Subject lines are required for sending e-
    mail notifications, in addition to the ## BEGIN SECTION Body and ## END SECTION Body lines.

    <pre>## BEGIN SECTION Subject
#set($project = $workflow.project)
Workflow: $project.Name - $workflow.Name
($workflow.BuildLife.LatestStampValue):
#if($workflow.Status.Name.equalsIgnoreCase('Complete'))
    Success
#else
    $workflow.Status.Name
#end
## END SECTION Subject
## BEGIN SECTION Body
## PROPERTY Content-Type: text/html
## PROPERTY X-Priority: 3
...
...
## END SECTION Body</pre>
    Once the IBM UrbanCode Build information is identified, it is incorporated in the Velocity Template. Complete Velocity
    Template creation is outside the scope of IBM UrbanCode Build. For detailed instructions on Velocity Template usage, see the Velocity
    Documentation [http://velocity.apache.org/].

    <h3>Example IM Notification Script</h3>
    Typically, IM templates are used to notify team members on process success or failure. The Template Text should
    be similar to what is below, and can be configured to return other events.
    <ol>
      <li>To view, go to System &gt; Notification Templates under the Notification menu.</li>
      <li>On the Notification Template List page, select the edit icon of the Simple IM Template.</li>
    </ol>
    <br/>
    The ## BEGIN SECTION Body and ## END SECTION Body lines are necessary in order for the message
    to be sent.

    <pre>## BEGIN SECTION Subject

#set($project = $workflow.Project)
#set($stamp = $workflow.BuildLife.latestStamp())

Workflow:
#if($stamp != "")
  $project.Name - $workflow.Name ($stamp):
#else
  $project.Name - $workflow.Name:
#end

#if($workflow.Status.equalsIgnoreCase("Complete"))
  Success
#else
  $workflow.Status
#end

## END SECTION Subject

## BEGIN SECTION Body

#if ( !$workflow )
#set($workflow = $request.WorkflowCase)
#end
#if($workflow.Status.equalsIgnoreCase("Complete"))
  Success
#else
  $workflow.Status
#end
#set($project = $workflow.Project)
#set($stamp = $workflow.BuildLife.latestStamp())
$project.Name - $workflow.Name #if($stamp != "") ($stamp) #end
$workflow.Url

## END SECTION Body</pre>

    <h3>Default Scripts</h3>
    The scripts listed below may be used on any notification template, regardless of the Event Selector used.
    <ul>
      <li>
        To retrieve the value of a named property and compare it to a expected value:
        <pre>    properties.get('os') == 'windows'
        - or -
    properties.equals('os', 'windows')</pre>
      </li>
      <li>
        To see if a named property with a non-blank, non-null value:
        <pre>    properties.has('os')
        - or -
    properties.isBlank('os')</pre>
      </li>
      <li>
        To see if a named multi-valued property has an expected value as one of its value:
        <pre>    properties.containsValue('os', 'windows')</pre>
      </li>
      <li>
        To create a set of recipients from an array of addresses:
        <pre>    recipients.forAddresses(['user1@domain.com', 'user2@domain.com']);</pre>
      </li>
      <li>
        To parse a comma-separated property named 'notification.recipients' into recipients:
        <pre>    recipients.forAddresses(properties.get('notification.recipients').split(','));</pre>
      </li>
      <li>
        To run a report named 'My Report':
        <pre>    reports.getReport('My Report').getResults()</pre>
      </li>
      <li>
        To run a report named 'My Report' and get the results in CSV:
        <pre>    reports.getReport('My Report').getResults().getCSV()</pre>
      </li>
      <li>
        To output the report in CSV directly into a notification template:
        <pre>    reports.getReport("My Report").Results.CSV</pre>
      </li>
      <li>
        To get the URL for the web application:
        <pre>    system.externalUrl</pre>
      </li>
      <li>
        To get the name of the Maven Artifact Set:
        <pre>    system.mavenArtifactSet</pre>
      </li>
    </ul>

    <br/>
    <h2>Recipient Generator Scripts</h2>
    <p>A recipient generator is responsible for determining which users should be notified when the Event Selector
    determines a notification should go out. A 'users' object is passed in to the scripts and provides access to some
    methods that can determine which users or groups of users should receive notifications. Recipient Generator scripts
    are written in JavaScript and return a list of users.

    <h3>Scripted Recipient Generator Examples</h3>
    To get all users in the system:
    <pre>    users.getAllUsers()</pre>

    To get all users in a group named 'Developers':
    <pre>    users.getAllUsersInGroup('Developers')</pre>

    <br/>
    <h2>Post-Processing Scripts</h2>
    <p>A post processing script checks the exit code and log from an executed step and determines whether that step was a
    success or failure. A typical script might check for a non-zero exit code and declare failure. Or it might look for the
    string 'Build Success' and mark the step as a success. Post Processing scripts are written in JavaScript.
    <br/><br/>
    You have access to a <code>java.util.Properties</code> variable called <code>properties</code>. The <code>properties</code>
    variable has several special properties: <code>exitCode</code> contains the process exit code, and <code>Status</code>
    contains the step's status. A <code>Status</code> value of <code>Success</code> means the step completed successfully.
    <br/><br/>
    Another available variable --<code>scanner</code>-- can scan the step's output log (scanning occurs on the agent) and
    take actions depending on the results. <code>scanner</code> has several public methods:
    <ul>
      <li><code>register(String regex, function call)</code> registers a function to be called when the regular
        expression is matched.</li>
      <li><code>addLOI(Integer lineNumber)</code> adds a line to the lines of interest list, which are highlighted in
        the Log Viewer; implicitly called whenever <code>scanner</code> matches a line.</li>
      <li><code>getLinesOfInterest()</code> returns a <code>java.util.List</code> of lines of interest;
        can be used to remove lines.</li>
      <li><code>scan()</code> scans the log. Use after all regular expressions are registered.</li>
    </ul>
    See also Using the Script Library.

    <h3>Post Process Limitations</h3>
    Post Process is not the solution to every need to determine success or failure because it is limited, run on the agents,
    and lacks access to helpers and files that we store on the server.
    IBM UrbanCode Build has a more powerful scripting step which can be used for added functionality. For instance, a testing suite
    will normally fail if any tests fail. If one wants to accept 5% of failures in a tool like JUnit, the post processing script
    will have to pass any number of failing tests. As a follow-up step, you could very easily use an "evaluate
    (BeanShell) script" step after the report publisher and use our JUnitReportHelper to get the object model of the JUnit
    tests and simply throw an exception (or print out something and use a post-process on that steps output to fail this
    step).
    <br/><br/>
    When success and failure can be determined by examining an exit code or some text in the log, the post-process
    script is excellent. When it requires knowing more about the project, other approaches are needed.

    <h3>Highlighting Lines of Interest in Log Files</h3>
    You can use regular expressions to highlight lines of interest in log files. The only limitation is that in order to avoid
    loading multi-gigabyte output/log files into memory, IBM UrbanCode Build does the matching on a line-by-line basis: therefore
    it is not possible to do an effective multiline pattern. For case sensitivity, IBM UrbanCode Build follows Java convention
    (see http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/Pattern.html). By default IBM UrbanCode Build is case sensitive;
    however, you can turn that (and other flags) on and off. For example, use: /(?i)error/ (@ee sections on "special
    constructs" and flags for doing things like matching whitespace, case sensitivity, unicode case-sensitivity, etc.).
    Examples:
    <pre>    /foo.*bar|bar.*foo/</pre>
    <code>&nbsp;&nbsp;&nbsp;&nbsp;/^error (?!foo|bar)/</code> (matches 'error baz' but not 'error foo' or 'error bar')

    <h3>Post-Processing Script Example</h3>
    The post-processing script can examine the step's output log, and take actions based on the result. In the
    following code fragment, <code>scanner.register()</code> registers a string with a regular expression engine,
    then takes an action if the string is found. Once all strings are registered, it calls <code>scanner.scan()</code> on
    the step's output log line by line.

    <pre>
    properties.put("Status", "Success");
    if (properties.get("exitCode") != 0) {
        properties.put("Status", "Failure");
    }
    else {
        scanner.register("(?i)ERROR at line", function(lineNumber, line) {
            var errors = properties.get("Error");
            if (errors == null) {
                errors = new java.util.ArrayList();
            }
            errors.add(line);
            properties.put("Error", errors);
            properties.put("Status", "Failure");
        });

        scanner.scan();
        var errors = properties.get("Error");
        if (errors == null) {
            errors = new java.util.ArrayList();
        }
        properties.put("Error", errors.toString());
    }
    </pre>

    <br/>
    <h2>Event Selectors</h2>
    <p>An Event Selector is responsible for inspecting events that pass through the event service for a process and returning
    true if a notification should fire. This could look at pretty much anything related to the event. For instance, if the
    selector is working on a process event and is intended for processes that use tests supported by IBM UrbanCode Build, it
    could examine the test results and notify if more than 10% of the tests failed, or if the tests took longer than expected.
    Event Selector scripts are written in JavaScript and must return true or false.
    <br/><br/>
    IBM UrbanCode Build ships with a number of Event Selectors that can be used as an example in creating custom selectors.
    <ol>
      <li>To view, go to System &gt; Event Selectors under the Notification menu.</li>
      <li>On the Event Selectors page, select the edit icon of the Selector of interest.</li>
    </ol>

    <h3>Example Event Selector Script</h3>
    Workflow Status Change:
    <pre>var result = false;
var prevBuildLife = workflow.getBuildLife().getPrevious()
if (prevBuildLife == null) {
    result = true
}
else {
    var prevWorkflowCase = prevBuildLife.getWorkflow()
    if (prevWorkflowCase == null || !prevWorkflowCase.isComplete() || prevWorkflowCase.statusIsSuccess() != workflow.statusIsSuccess()) {
        result = true
    }
}

result
    </pre>
<P>

<P>
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Overview</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Package</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <FONT CLASS="NavBarFont1">Class</FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="overview-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="serialized-form.html"><FONT CLASS="NavBarFont1"><B>Serialized</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="index.html?overview-summary.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="overview-summary.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

</BODY>
</HTML>
