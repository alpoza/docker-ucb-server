<?xml version="1.0"?>
<!--
- Licensed Materials - Property of IBM Corp.
- IBM UrbanCode Build
- IBM UrbanCode Deploy
- IBM UrbanCode Release
- IBM AnthillPro
- (c) Copyright IBM Corporation 2002, 2014. All Rights Reserved.
-
- U.S. Government Users Restricted Rights - Use, duplication or disclosure restricted by
- GSA ADP Schedule Contract with IBM Corp.
-->
<change-set release="1.0">
  <change number="1">
    <description>First database version</description>
    <sql separator=";"></sql>
  </change>
  <change number="2">
    <description>Increase max size of property definition description to 4000</description>
    <sql separator=";">
    alter table ps_prop_def alter column description set data type varchar(4000);
    </sql>
  </change>
  <change number="3">
    <description>Add support for long default values on property definitions.</description>
    <sql separator=";">
    alter table ps_prop_def add column long_default_value clob;
    </sql>
  </change>
  <change number="4">
    <description>Add template property sheet.</description>
    <sql separator=";">
    alter table ps_prop_sheet add column template_prop_sheet_id varchar(36);
    alter table ps_prop_sheet add constraint ps_prop_sheet_template foreign key(template_prop_sheet_id) references ps_prop_sheet(id);
    </sql>
  </change>
  <change number="5">
    <description>Added more complete references from DB objects to versioned objects</description>
    <sql separator=";">
        alter table ps_prop_sheet_def add column template_handle varchar(256);
        alter table ps_prop_sheet_def add column template_prop_sheet_def_id varchar(36);
        
        create table ps_prop_sheet_handle (
            id varchar(36) not null primary key,
            version integer default 0 not null,
            prop_sheet_handle varchar(256) not null,
            prop_sheet_def_id varchar(36) not null
        );
        
        alter table ps_prop_sheet add column prop_sheet_def_handle varchar(256);

        create unique index ps_prop_sheet_handle_uci on ps_prop_sheet_handle(prop_sheet_def_id, prop_sheet_handle);
        create index ps_psh_prop_sheet_def_id on ps_prop_sheet_handle(prop_sheet_def_id);
        alter table ps_prop_sheet_handle add constraint ps_prop_sheet_handle_uc unique(prop_sheet_def_id, prop_sheet_handle);
        alter table ps_prop_sheet_handle add constraint ps_psh_2_psd foreign key(prop_sheet_def_id) references ps_prop_sheet_def(id);
    </sql>
  </change>
  <change number="6">
    <description>Add pattern for Property Definition</description>
    <sql separator=";">
       alter table ps_prop_def add column pattern varchar(255);
    </sql>
  </change>
  <change number="7">
    <description>Remove unique constraints</description>
    <sql separator=";">
        alter table ps_prop_def drop constraint ps_prop_def_uc;
        alter table ps_prop_sheet_handle drop constraint ps_prop_sheet_handle_uc;
        alter table ps_prop_value drop constraint ps_prop_val_uc;
    </sql>
  </change>
</change-set>
