<?xml version="1.0"?>
<!--
- Licensed Materials - Property of IBM Corp.
- IBM UrbanCode Build
- (c) Copyright IBM Corporation 2012, 2014. All Rights Reserved.
-
- U.S. Government Users Restricted Rights - Use, duplication or disclosure restricted by
- GSA ADP Schedule Contract with IBM Corp.
-->

<change-set release="4.0">

    <change number="1">
        <description>Initial version.</description>
    </change>
    <change number="2">
        <description>Add dimension columns.</description>
        <sql separator=";">
CREATE TABLE REP_DIMENSION_COLUMN (
    PARENT_ID VARCHAR(36) NOT NULL,
    NAME VARCHAR(30) NOT NULL,
    DESCRIPTION VARCHAR(4000),
    NULLABLE NUMERIC DEFAULT 1 NOT NULL,
    DIMENSION_ID VARCHAR(36),
    PRIMARY KEY (PARENT_ID, NAME)
);
        </sql>
    </change>
    <change number="3">
        <description>Add primary key to dimensions.</description>
        <sql separator=";">
ALTER TABLE REP_DIMENSION_COLUMN ADD PRIMARY_KEY NUMERIC DEFAULT 0 NOT NULL;
UPDATE REP_DIMENSION_COLUMN SET PRIMARY_KEY = 0;
        </sql>
    </change>
    <change number="4">
        <description>Add mutable flag to dimensions.</description>
        <sql separator=";">
ALTER TABLE REP_DIMENSION ADD COLUMN MUTABLE NUMERIC;
        </sql>
    </change>
    <change number="5">
        <description>Add display name to tables and columns.</description>
        <sql separator=";">
ALTER TABLE REP_FACT_TABLE ADD COLUMN DISPLAY_NAME VARCHAR(100);
ALTER TABLE REP_FACT_TABLE_COLUMN ADD COLUMN DISPLAY_NAME VARCHAR(100);
ALTER TABLE REP_DIMENSION ADD COLUMN DISPLAY_NAME VARCHAR(100);
ALTER TABLE REP_DIMENSION_COLUMN ADD COLUMN DISPLAY_NAME VARCHAR(100);
        </sql>
    </change>
    <change number="6">
        <description>Add saved reports.</description>
        <sql separator=";">
CREATE TABLE REP_REPORT (
    ID VARCHAR(36) NOT NULL,
    NAME VARCHAR(30) NOT NULL,
    DESCRIPTION VARCHAR(4000),
    RESOURCE_ID VARCHAR(36),
    QUERY CLOB NOT NULL,
    PRIMARY KEY (ID)
);
ALTER TABLE REP_REPORT ADD CONSTRAINT RR_NAME_UNIQUE UNIQUE(NAME);
        </sql>
    </change>
    <change number="7">
        <description>Add security for stand-alone reporting.</description>
        <sql separator=";">
insert into sec_resource_type (id, version, name, enabled)
    values ('00000000-0000-0000-0000-000000100022', 0, 'Security', 1);
        </sql>
    </change>
    <change number="8">
        <description>Add security for embedded reporting.</description>
        <sql separator=";">
insert into sec_resource_type (id, version, name, enabled)
    values ('00000000-0000-0000-0000-000000100000', 0, 'Report', 1);

insert into sec_action (id, version, name, description, enabled, cascading, sec_resource_type_id)
    values ('00000000-0000-0000-0000-000001000000', 0, 'Report Run', 'Ability to run a report.', 1, 0, '00000000-0000-0000-0000-000000100000');

insert into sec_action (id, version, name, description, enabled, cascading, sec_resource_type_id)
    values ('00000000-0000-0000-0000-000001000001', 0, 'Report Edit', 'Ability to edit and delete a report.', 1, 0, '00000000-0000-0000-0000-000000100000');

insert into sec_action (id, version, name, description, enabled, cascading, sec_resource_type_id)
    values ('00000000-0000-0000-0000-000001000002', 0, 'Report Create', 'Ability to create reports.', 1, 0, '00000000-0000-0000-0000-000000100022');
        </sql>
    </change>
    <change number="9">
        <description>Add output configuration to saved reports.</description>
        <sql separator=";">
ALTER TABLE REP_REPORT ADD COLUMN OUTPUT_CONFIG CLOB;
        </sql>
    </change>
    <change number="10">
        <description>Increase the size of report names.</description>
        <sql separator=";">
ALTER TABLE REP_REPORT ALTER COLUMN NAME SET DATA TYPE VARCHAR(100);
        </sql>
    </change>
</change-set>
